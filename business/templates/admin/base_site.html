{% extends "admin/base.html" %}
{% load static %}
{% load pwa %}

{% block title %}{{ title }} | U-Connect Admin{% endblock %}

{% block extrahead %}
{{ block.super }}
{% progressive_web_app_meta %}
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('/serviceworker.js')
                .then(reg => console.log('Admin SW registered'))
                .catch(err => console.log('Admin SW failed', err));
        });
    }
</script>
{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">U-Connect Administration</a></h1>
{% endblock %}

{% block userlinks %}
    <a href="#" id="admin-install-app-btn" style="display: none; margin-right: 15px; font-weight: bold; color: #4f46e5;">Install App</a>
    {{ block.super }}
    <script>
        let deferredPrompt;
        const installBtn = document.getElementById('admin-install-app-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show button when ready
            if (installBtn) installBtn.style.display = 'inline-block';
        });

        if (installBtn) {
            installBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            installBtn.style.display = 'none';
                        }
                        deferredPrompt = null;
                    });
                }
            });
        }
    </script>
{% endblock %}