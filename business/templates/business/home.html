{% extends 'business/base.html' %}

{% block title %}Buy - U-Connect{% endblock %}

{% block content %}
<style>
    @media (max-width: 768px) {
        .container {
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }
    }
</style>
<div class="container">
    <h1 style="margin-bottom: 2rem; font-weight: 800; color: var(--text-main);">Marketplace</h1>
    
    {% if items %}
        {# Sort items by category first so regroup works correctly #}
        {% regroup items|dictsort:"category" by get_category_display as category_list %}

        {% for category in category_list %}
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">{{ category.grouper }}</h2>
            </div>
            
            <div class="horizontal-scroll-container">
                {% for item in category.list %}
                <div class="item-card">
                    <a href="{% url 'business:item_detail' item.id %}" style="text-decoration: none; color: inherit; display: block;">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image">
                        {% endif %}
                        <div class="item-details">
                            <h3 class="item-title">{{ item.title }}</h3>
                            <p class="item-price">{{ item.price }}</p>
                            <div class="item-meta">
                                <span><i class="bi bi-geo-alt"></i> {{ item.campus_location }}</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p style="text-align: center; color: var(--text-muted); font-size: 1.2rem;">No items listed yet. Be the first to sell!</p>
    {% endif %}
</div>
{% endblock %}