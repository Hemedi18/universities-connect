{% extends 'business/base.html' %}

{% block title %}Buy - U-Connect{% endblock %}

{% block content %}
<div class="home-container-mobile">
    <h1 class="home-title">Marketplace</h1>
    
    {% if items %}
        {# Sort items by category first so regroup works correctly #}
        {% regroup items|dictsort:"category" by get_category_display as category_list %}

        {% for category in category_list %}
        <div class="category-section">
            <div class="category-header">
                <h2 class="category-title">{{ category.grouper }}</h2>
            </div>
            
            <div class="horizontal-scroll-container">
                {% for item in category.list %}
                <div class="item-card">
                    <a href="{% url 'business:item_detail' item.id %}" class="item-link-block">
                        {% if item.image %}
                            <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image">
                        {% endif %}
                        <div class="item-details">
                            <h3 class="item-title">{{ item.title }}</h3>
                            <p class="item-price">{{ item.price }}</p>
                            <div class="item-meta">
                                <span class="item-location"><i class="bi bi-geo-alt-fill"></i> {{ item.campus_location }}</span>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="home-empty-text">No items listed yet. Be the first to sell!</p>
    {% endif %}
</div>
{% endblock %}