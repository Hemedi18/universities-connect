{% load static %}
{% load pwa %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'images/uconnect.ico' %}">
    {% progressive_web_app_meta %}
    <!-- The title block can be overridden by child templates -->
    <title>{% block title %}U-Connect{% endblock %}</title>
    
    <!-- Link to your main stylesheet (You can add this file later) -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    
</head>
<body>

    <header class="main-header">
        <nav class="navbar">
            <div class="navbar-brand">
                <a href="{% url 'business:home' %}">U-Connect</a>
            </div>
            <div class="navbar-links">
                <ul>
                    {% if user.is_authenticated %}
                    <li>
                        <a href="{% url 'business:home' %}" title="Buy">
                            <i class="bi bi-shop"></i>
                            <span>Buy</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'business:post_item' %}" title="Sell">
                            <i class="bi bi-plus-square"></i>
                            <span>Sell</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'business:view_cart' %}" title="Cart">
                            <i class="bi bi-cart"></i>
                            <span>Cart</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'chat:inbox' %}" title="Messages">
                            <i class="bi bi-chat-dots-fill"></i>
                            <span>Chat</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:home' %}" title="Account">
                            <i class="bi bi-person-circle"></i>
                            <span>Account</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:logout' %}" title="Logout">
                            <i class="bi bi-box-arrow-right"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                    {% else %}
                    <li>
                        <a href="{% url 'business:about' %}" title="About">
                            <i class="bi bi-info-circle"></i>
                            <span>About</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'business:contact' %}" title="Contact">
                            <i class="bi bi-question-circle-fill"></i>
                            <span>Contact</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:login' %}" title="Login">
                            <i class="bi bi-box-arrow-in-right"></i>
                            <span>Login</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'users:register' %}" title="Register">
                            <i class="bi bi-person-plus"></i>
                            <span>Register</span>
                        </a>
                    </li>
                    {% endif %}
                    <li id="install-app-item">
                        <a href="#" id="install-app-btn" title="Install App">
                            <i class="bi bi-download"></i>
                            <span>Install</span>
                        </a>
                    </li>
                    <li><a><button id="theme-toggle-btn" class="theme-toggle-btn">ðŸŒ™</button><span>Theme</span></a></li>
                </ul>
                
            </div>
            <div class="hamburger">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </nav>
    </header>

    <main class="container">
        <!-- This is where the content of other pages will be inserted -->
        {% block content %}{% endblock %}
    </main>

    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>U-Connect</h3>
                <p>The trusted marketplace for students to buy, sell, and connect on campus.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="{% url 'business:home' %}">Marketplace</a></li>
                    <li><a href="{% url 'business:about' %}">About Us</a></li>
                    <li><a href="{% url 'business:contact' %}">Contact Support</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><i class="bi bi-envelope-fill"></i> support@u-connect.com</p>
                <p><i class="bi bi-telephone-fill"></i> +255 123 456 789</p>
                <p><i class="bi bi-geo-alt-fill"></i> Main Campus, Student Center</p>
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-icons">
                    <a href="#"><i class="bi bi-facebook"></i></a>
                    <a href="#"><i class="bi bi-twitter-x"></i></a>
                    <a href="#"><i class="bi bi-instagram"></i></a>
                    <a href="#"><i class="bi bi-whatsapp"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {% now "Y" %} U-Connect. All rights reserved.</p>
        </div>
    </footer>

    <!-- Load JavaScript for animations -->
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script src="{% static 'js/main.js' %}"></script>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/serviceworker.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW failed:', err));
            });
        }

        // Install App Logic
        let deferredPrompt;
        const installItem = document.getElementById('install-app-item');
        const installBtn = document.getElementById('install-app-btn');

        // Hide button initially (if using CSS to show it, ensure it starts hidden)
        if (installItem) installItem.style.display = 'none';

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Show the install button only when the prompt is ready
            if (installItem) installItem.style.display = 'block';
        });

        if (installBtn) {
            installBtn.addEventListener('click', (e) => {
                e.preventDefault();
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                            if (installItem) installItem.style.display = 'none';
                        }
                        deferredPrompt = null;
                    });
                }
            });
        }
    </script>
</body>
</html>
